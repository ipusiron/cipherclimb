<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>サイファー・クライム（Cipher Climb）</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="englishWords.js"></script>
  <script src="bigramScores.js"></script>
  <script src="trigramScores.js"></script>
</head>
<body>
<div class="header-buttons">
  <button id="helpButton" onclick="showHelp()">❔ ヘルプ</button>
  <button id="toggleTheme">🌙 ダークモード</button>
</div>
<h1>🧗 サイファー・クライム（Cipher Climb）</h1>
<p>このツールは <strong>単一換字式暗号</strong> の解読専用です（ヴィジュネルなど非対応）。</p>

  <div class="container">

    <!-- 🔐 入力と設定 -->
    <section class="card">
      <h2>🔐 暗号文の入力</h2>
      <textarea id="cipherText" rows="6" style="width:100%;">
VR DPFY HRYRX HYOHXRH HP ZR XBRQ KAKFRH HTPB TBB UUR YTY GYFRHT GRGTL HTPH HIRY TYY FRFPSYR IZ HRYD GYTYPV HPDR XYGXRYX ESGTXYRTYB GRFPHX HTPH TUSPR HRYRX TYY ABRY BYBRYA TBX HRYXBRX TBB ARA FYFHR YTY HBYLBRY HPDR OKYHRXYB TYY AK FRFYARF CR HRY JPYLYX DRUL HRY RGSRXRYT YP HRY OYKSRYFR HTPH VRYSRIR TST LPHJ YP OYKSRYFR BUICRYX FXH XKYARFHRX TST SPOYSAXYH AR XJYH LRYAXJTBYX TST PGYTYASXARX FXH SPIYHRX AR XJYH DRUL TX HTPH DIRB XTTY BBRU UBHX NIIBAHP HP YRRFR HRYDA IXHRX ARD HRYLBRRX
	  </textarea>

      <h3>🧠 アルゴリズム設定</h3>
      <label><input type="checkbox" id="useAnnealing" checked> 焼きなまし法を使用</label>

      <h3>⚙️ スコア構成</h3>
      <label><input type="checkbox" id="score_letter" checked> 文字頻度</label><br>
      <label><input type="checkbox" id="score_ngram" checked> N-gram</label><br>
	  <label><input type="checkbox" id="score_dict" checked> 辞書照合  単語の重み</label>
<select id="dictWeight" style="margin-left: 0.5em;">
  <option value="30">30（単語弱め）</option>
  <option value="50">50</option>
  <option value="100" selected>100（バランス型）</option>
  <option value="150">150</option>
  <option value="200">200（単語を最重視）</option>
</select>

      <div class="controls">
        <label>試行回数（最大5000）:
          <input type="number" id="maxTries" value="1000" max="5000">
        </label><br>
        <button onclick="startClimb()">スタート</button>
        <button onclick="cancelClimb()">停止</button>
      </div>

      <div class="progress-area">
        <h3>⏳ 進行状況</h3>
        <progress id="progressBar" value="0" max="100"></progress>
      </div>
    </section>

    <!-- ✅ 結果表示 -->
<section class="card result">
  <h2>📋 解読結果</h2>

  <h3>🔄 解読中の情報</h3>
  <div id="statusArea" class="highlight-box">(ステータス表示)</div>

  <h3>🔑 鍵の対応表</h3>
  <pre id="keyTable"></pre>

  <h3>📊 スコア</h3>
  <div id="scoreDisplay">スコア: -</div>

  <h3>📈 スコアの推移</h3>
  <canvas id="scoreChart" height="100"></canvas>

  <h3>📝 解読結果</h3>
  <div id="highlightedText" class="highlight-box"></div>
  <div id="highlightCount" class="meta-info"></div>
  <button onclick="copyResult()">コピー</button>
</section>


  </div>

  <!-- フッター -->
  <footer class="app-footer">
    <div class="footer">
      🔗 GitHubリポジトリはこちら（<a href="https://github.com/ipusiron/cipherclimb" target="_blank">ipusiron/cipherclimb</a>）
    </div>
  </footer>

  <!-- ヘルプモーダル -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="hideHelp()">&times;</span>
      <h2>❔ ヘルプ：Cipher Climbとは？</h2>
      <ul>
        <li>焼きなまし法／ヒルクライミング法による鍵探索</li>
        <li>英単語のハイライトで復号の進展を可視化</li>
        <li>スコア構成を切り替えてアルゴリズムを学ぶ</li>
      </ul>
    </div>
  </div>

  <!-- モジュール読み込み -->
  <script type="module">
    import { startClimb, cancelClimb, showHelp, hideHelp, copyResult } from './main.js';
    window.startClimb = startClimb;
    window.cancelClimb = cancelClimb;
    window.showHelp = showHelp;
    window.hideHelp = hideHelp;
    window.copyResult = copyResult;

    function applyTheme() {
      const mode = localStorage.getItem("theme");
      const body = document.body;
      const btn = document.getElementById("toggleTheme");
      if (mode === "dark") {
        body.classList.add("dark-mode");
        btn.textContent = "☀️ ライトモード";
      } else {
        body.classList.remove("dark-mode");
        btn.textContent = "🌙 ダークモード";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      applyTheme();
      document.getElementById("toggleTheme").addEventListener("click", () => {
        const isDark = document.body.classList.toggle("dark-mode");
        localStorage.setItem("theme", isDark ? "dark" : "light");
        applyTheme();
      });
    });
  </script>
</body>
</html>
